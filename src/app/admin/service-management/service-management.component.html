<!-- service-management.component.html -->
<div class="service-management">
  <h2>{{ editingService ? 'Edit Service' : 'Add New Service' }}</h2>

  <form [formGroup]="serviceForm" (ngSubmit)="submitService()" class="service-form">
    <mat-form-field appearance="fill">
      <mat-label>Service Name</mat-label>
      <input matInput formControlName="name" required/>
      <mat-error *ngIf="serviceForm.get('name')?.hasError('required')">
        Service name is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description" required></textarea>
      <mat-error *ngIf="serviceForm.get('description')?.hasError('required')">
        Description is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Price</mat-label>
      <input matInput type="number" formControlName="price" required/>
      <mat-error *ngIf="serviceForm.get('price')?.hasError('required')">
        Price is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Category</mat-label>
      <mat-select formControlName="categoryId" required multiple>
        <mat-option *ngFor="let category of categories" [value]="category.id">
          {{ category.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="serviceForm.get('categoryId')?.hasError('required')">
        Category is required
      </mat-error>
    </mat-form-field>

    <!--    <mat-form-field appearance="fill">-->
    <!--      <mat-label>Image</mat-label>-->
    <!--      <input matInput type="file" (change)="onFileChange($event)" />-->
    <button type="button" mat-raised-button (click)="fileInput.click()">Choose File</button>
    <input hidden (change)="onFileChange($event)" #fileInput type="file" id="file">
    <img *ngIf="serviceForm.get('imageUrl')?.value" [src]="serviceForm.get('imageUrl')?.value" alt="Image Preview"
         class="image-preview"/>
    <!--    </mat-form-field>-->

    <button mat-raised-button color="primary" type="submit">
      {{ editingService ? 'Update Service' : 'Add Service' }}
    </button>
    <button
      mat-button
      type="button"
      (click)="resetForm()"
      *ngIf="editingService"
    >
      Cancel
    </button>
  </form>

  <h2>Existing Services</h2>
  <table mat-table [dataSource]="services" class="mat-elevation-z8 service-table">
    <!-- Columns -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Service Name</th>
      <td mat-cell *matCellDef="let service"> {{ service.name }}</td>
    </ng-container>

    <ng-container matColumnDef="category">
      <th mat-header-cell *matHeaderCellDef> Category</th>
      <td mat-cell *matCellDef="let service">
        {{ getCategoryName(service.categoryId) }}
      </td>
    </ng-container>

    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef> Price</th>
      <td mat-cell *matCellDef="let service"> ${{ service.price }}</td>
    </ng-container>

    <ng-container matColumnDef="image">
      <th mat-header-cell *matHeaderCellDef> Image</th>
      <td mat-cell *matCellDef="let service">
        <img *ngIf="service.imageUrl" [src]="service.imageUrl" alt="{{ service.name }}" class="service-image"/>
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Actions</th>
      <td mat-cell *matCellDef="let service">
        <button mat-button (click)="editService(service)">Edit</button>
        <button mat-button color="warn" (click)="deleteService(service.id)">
          Delete
        </button>
      </td>
    </ng-container>

    <!-- Header and Row Declarations -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</div>
